Vfunction ItemListHelper(listType, supportedSorting, supportedFilters, defaultSorting, defaultFilters, exclusiveFilters, filesPerPage) {\u000a    var self = this;\u000a\u000a    self.listType = listType;\u000a    self.supportedSorting = supportedSorting;\u000a    self.supportedFilters = supportedFilters;\u000a    self.defaultSorting = defaultSorting;\u000a    self.defaultFilters = defaultFilters;\u000a    self.exclusiveFilters = exclusiveFilters;\u000a\u000a    self.searchFunction = undefined;\u000a\u000a    self.allItems = [];\u000a    self.allSize = ko.observable(0);\u000a\u000a    self.items = ko.observableArray([]);\u000a    self.pageSize = ko.observable(filesPerPage);\u000a    self.currentPage = ko.observable(0);\u000a    self.currentSorting = ko.observable(self.defaultSorting);\u000a    self.currentFilters = ko.observableArray(self.defaultFilters);\u000a    self.selectedItem = ko.observable(undefined);\u000a\u000a    //~~ item handling\u000a\u000a    self.refresh = function() {\u000a        self._updateItems();\u000a    };\u000a\u000a    self.updateItems = function(items) {\u000a        self.allItems = items;\u000a        self.allSize(items.length);\u000a        self._updateItems();\u000a    };\u000a\u000a    self.selectItem = function(matcher) {\u000a        var itemList = self.items();\u000a        for (var i = 0; i < itemList.length; i++) {\u000a            if (matcher(itemList[i])) {\u000a                self.selectedItem(itemList[i]);\u000a                break;\u000a            }\u000a        }\u000a    };\u000a\u000a    self.selectNone = function() {\u000a        self.selectedItem(undefined);\u000a    };\u000a\u000a    self.isSelected = function(data) {\u000a        return self.selectedItem() == data;\u000a    };\u000a\u000a    self.isSelectedByMatcher = function(matcher) {\u000a        return matcher(self.selectedItem());\u000a    };\u000a\u000a    self.removeItem = function(matcher) {\u000a        var item = self.getItem(matcher, true);\u000a        if (item === undefined) {\u000a            return;\u000a        }\u000a\u000a        var index = self.allItems.indexOf(item);\u000a        if (index > -1) {\u000a            self.allItems.splice(index, 1);\u000a            self._updateItems();\u000a        }\u000a    };\u000a\u000a    //~~ pagination\u000a\u000a    self.paginatedItems = ko.dependentObservable(function() {\u000a        if (self.items() == undefined) {\u000a            return [];\u000a        } else if (self.pageSize() == 0) {\u000a            return self.items();\u000a        } else {\u000a            var from = Math.max(self.currentPage() * self.pageSize(), 0);\u000a            var to = Math.min(from + self.pageSize(), self.items().length);\u000a            return self.items().slice(from, to);\u000a        }\u000a    });\u000a    self.lastPage = ko.dependentObservable(function() {\u000a        return (self.pageSize() == 0 ? 1 : Math.ceil(self.items().length / self.pageSize()) - 1);\u000a    });\u000a    self.pages = ko.dependentObservable(function() {\u000a        var pages = [];\u000a        if (self.pageSize() == 0) {\u000a            pages.push({ number: 0, text: 1 });\u000a        } else if (self.lastPage() < 7) {\u000a            for (var i = 0; i < self.lastPage() + 1; i++) {\u000a                pages.push({ number: i, text: i+1 });\u000a            }\u000a        } else {\u000a            pages.push({ number: 0, text: 1 });\u000a            if (self.currentPage() < 5) {\u000a                for (var i = 1; i < 5; i++) {\u000a                    pages.push({ number: i, text: i+1 });\u000a                }\u000a                pages.push({ number: -1, text: "\u2026"});\u000a            } else if (self.currentPage() > self.lastPage() - 5) {\u000a                pages.push({ number: -1, text: "\u2026"});\u000a                for (var i = self.lastPage() - 4; i < self.lastPage(); i++) {\u000a                    pages.push({ number: i, text: i+1 });\u000a                }\u000a            } else {\u000a                pages.push({ number: -1, text: "\u2026"});\u000a                for (var i = self.currentPage() - 1; i <= self.currentPage() + 1; i++) {\u000a                    pages.push({ number: i, text: i+1 });\u000a                }\u000a                pages.push({ number: -1, text: "\u2026"});\u000a            }\u000a            pages.push({ number: self.lastPage(), text: self.lastPage() + 1})\u000a        }\u000a        return pages;\u000a    });\u000a\u000a    self.switchToItem = function(matcher) {\u000a        var pos = -1;\u000a        var itemList = self.items();\u000a        for (var i = 0; i < itemList.length; i++) {\u000a            if (matcher(itemList[i])) {\u000a                pos = i;\u000a                break;\u000a            }\u000a        }\u000a\u000a        if (pos > -1) {\u000a            var page = Math.floor(pos / self.pageSize());\u000a            self.changePage(page);\u000a        }\u000a    };\u000a\u000a    self.changePage = function(newPage) {\u000a        if (newPage < 0 || newPage > self.lastPage())\u000a            return;\u000a        self.currentPage(newPage);\u000a    };    self.prevPage = function() {\u000a        if (self.currentPage() > 0) {\u000a            self.currentPage(self.currentPage() - 1);\u000a        }\u000a    };\u000a    self.nextPage = function() {\u000a        if (self.currentPage() < self.lastPage()) {\u000a            self.currentPage(self.currentPage() + 1);\u000a        }\u000a    };\u000a\u000a    self.getItem = function(matcher, all) {\u000a        var itemList;\u000a        if (all !== undefined && all === true) {\u000a            itemList = self.allItems;\u000a        } else {\u000a            itemList = self.items();\u000a        }\u000a        for (var i = 0; i < itemList.length; i++) {\u000a            if (matcher(itemList[i])) {\u000a                return itemList[i];\u000a            }\u000a        }\u000a\u000a        return undefined;\u000a    };\u000a\u000a    //~~ searching\u000a\u000a    self.changeSearchFunction = function(searchFunction) {\u000a        self.searchFunction = searchFunction;\u000a        self.changePage(0);\u000a        self._updateItems();\u000a    };\u000a\u000a    self.resetSearch = function() {\u000a        self.changeSearchFunction(undefined);\u000a    };\u000a\u000a    //~~ sorting\u000a\u000a    self.changeSorting = function(sorting) {\u000a        if (!_.contains(_.keys(self.supportedSorting), sorting))\u000a            return;\u000a\u000a        self.currentSorting(sorting);\u000a        self._saveCurrentSortingToLocalStorage();\u000a\u000a        self.changePage(0);\u000a        self._updateItems();\u000a    };\u000a\u000a    //~~ filtering\u000a\u000a    self.toggleFilter = function(filter) {\u000a        if (!_.contains(_.keys(self.supportedFilters), filter))\u000a            return;\u000a\u000a        if (_.contains(self.currentFilters(), filter)) {\u000a            self.removeFilter(filter);\u000a        } else {\u000a            self.addFilter(filter);\u000a        }\u000a    };\u000a\u000a    self.addFilter = function(filter) {\u000a        if (!_.contains(_.keys(self.supportedFilters), filter))\u000a            return;\u000a\u000a        for (var i = 0; i < self.exclusiveFilters.length; i++) {\u000a            if (_.contains(self.exclusiveFilters[i], filter)) {\u000a                for (var j = 0; j < self.exclusiveFilters[i].length; j++) {\u000a                    if (self.exclusiveFilters[i][j] == filter)\u000a                        continue;\u000a                    self.removeFilter(self.exclusiveFilters[i][j]);\u000a                }\u000a            }\u000a        }\u000a\u000a        var filters = self.currentFilters();\u000a        filters.push(filter);\u000a        self.currentFilters(filters);\u000a        self._saveCurrentFiltersToLocalStorage();\u000a\u000a        self.changePage(0);\u000a        self._updateItems();\u000a    };\u000a\u000a    self.removeFilter = function(filter) {\u000a        if (!_.contains(_.keys(self.supportedFilters), filter))\u000a            return;\u000a\u000a        var filters = self.currentFilters();\u000a        filters.pop(filter);\u000a        self.currentFilters(filters);\u000a        self._saveCurrentFiltersToLocalStorage();\u000a\u000a        self.changePage(0);\u000a        self._updateItems();\u000a    };\u000a\u000a    //~~ update for sorted and filtered view\u000a\u000a    self._updateItems = function() {\u000a        // determine comparator\u000a        var comparator = undefined;\u000a        var currentSorting = self.currentSorting();\u000a        if (typeof currentSorting !== undefined && typeof self.supportedSorting[currentSorting] !== undefined) {\u000a            comparator = self.supportedSorting[currentSorting];\u000a        }\u000a\u000a        // work on all items\u000a        var result = self.allItems;\u000a\u000a        // filter if necessary\u000a        var filters = self.currentFilters();\u000a        _.each(filters, function(filter) {\u000a            if (typeof filter !== undefined && typeof supportedFilters[filter] !== undefined)\u000a                result = _.filter(result, supportedFilters[filter]);\u000a        });\u000a\u000a        // search if necessary\u000a        if (typeof self.searchFunction !== undefined && self.searchFunction) {\u000a            result = _.filter(result, self.searchFunction);\u000a        }\u000a\u000a        // sort if necessary\u000a        if (typeof comparator !== undefined)\u000a            result.sort(comparator);\u000a\u000a        // set result list\u000a        self.items(result);\u000a    };\u000a\u000a    //~~ local storage\u000a\u000a    self._saveCurrentSortingToLocalStorage = function() {\u000a        if ( self._initializeLocalStorage() ) {\u000a            var currentSorting = self.currentSorting();\u000a            if (currentSorting !== undefined)\u000a                localStorage[self.listType + "." + "currentSorting"] = currentSorting;\u000a            else\u000a                localStorage[self.listType + "." + "currentSorting"] = undefined;\u000a        }\u000a    };\u000a\u000a    self._loadCurrentSortingFromLocalStorage = function() {\u000a        if ( self._initializeLocalStorage() ) {\u000a            if (_.contains(_.keys(supportedSorting), localStorage[self.listType + "." + "currentSorting"]))\u000a                self.currentSorting(localStorage[self.listType + "." + "currentSorting"]);\u000a            else\u000a                self.currentSorting(defaultSorting);\u000a        }\u000a    };\u000a\u000a    self._saveCurrentFiltersToLocalStorage = function() {\u000a        if ( self._initializeLocalStorage() ) {\u000a            var filters = _.intersection(_.keys(self.supportedFilters), self.currentFilters());\u000a            localStorage[self.listType + "." + "currentFilters"] = JSON.stringify(filters);\u000a        }\u000a    };\u000a\u000a    self._loadCurrentFiltersFromLocalStorage = function() {\u000a        if ( self._initializeLocalStorage() ) {\u000a            self.currentFilters(_.intersection(_.keys(self.supportedFilters), JSON.parse(localStorage[self.listType + "." + "currentFilters"])));\u000a        }\u000a    };\u000a\u000a    self._initializeLocalStorage = function() {\u000a        if (!Modernizr.localstorage)\u000a            return false;\u000a\u000a        if (localStorage[self.listType + "." + "currentSorting"] !== undefined && localStorage[self.listType + "." + "currentFilters"] !== undefined && JSON.parse(localStorage[self.listType + "." + "currentFilters"]) instanceof Array)\u000a            return true;\u000a\u000a        localStorage[self.listType + "." + "currentSorting"] = self.defaultSorting;\u000a        localStorage[self.listType + "." + "currentFilters"] = JSON.stringify(self.defaultFilters);\u000a\u000a        return true;\u000a    };\u000a\u000a    self._loadCurrentFiltersFromLocalStorage();\u000a    self._loadCurrentSortingFromLocalStorage();\u000a}\u000a\u000afunction formatSize(bytes) {\u000a    if (!bytes) return "-";\u000a\u000a    var units = ["bytes", "KB", "MB", "GB"];\u000a    for (var i = 0; i < units.length; i++) {\u000a        if (bytes < 1024) {\u000a            return _.sprintf("%3.1f%s", bytes, units[i]);\u000a        }\u000a        bytes /= 1024;\u000a    }\u000a    return _.sprintf("%.1f%s", bytes, "TB");\u000a}\u000a\u000afunction bytesFromSize(size) {\u000a    if (size == undefined || size.trim() == "") return undefined;\u000a\u000a    var parsed = size.match(/^([+]?[0-9]*\u005c.?[0-9]+)(?:\u005cs*)?(.*)$/);\u000a    var number = parsed[1];\u000a    var unit = parsed[2].trim();\u000a\u000a    if (unit == "") return parseFloat(number);\u000a\u000a    var units = {\u000a        b: 1,\u000a        byte: 1,\u000a        bytes: 1,\u000a        kb: 1024,\u000a        mb: Math.pow(1024, 2),\u000a        gb: Math.pow(1024, 3),\u000a        tb: Math.pow(1024, 4)\u000a    };\u000a    unit = unit.toLowerCase();\u000a\u000a    if (!units.hasOwnProperty(unit)) {\u000a        return undefined;\u000a    }\u000a\u000a    var factor = units[unit];\u000a    return number * factor;\u000a}\u000a\u000afunction formatDuration(seconds) {\u000a    if (!seconds) return "-";\u000a    if (seconds < 0) return "00:00:00";\u000a\u000a    var s = seconds % 60;\u000a    var m = (seconds % 3600) / 60;\u000a    var h = seconds / 3600;\u000a\u000a    return _.sprintf(gettext(/* L10N: duration format */ "%(hour)02d:%(minute)02d:%(second)02d"), {hour: h, minute: m, second: s});\u000a}\u000a\u000afunction formatFuzzyEstimation(seconds, base) {\u000a    if (!seconds) return "-";\u000a    if (seconds < 0) return "-";\u000a\u000a    var m;\u000a    if (base != undefined) {\u000a        m = moment(base);\u000a    } else {\u000a        m = moment();\u000a    }\u000a\u000a    m.add(seconds, "s");\u000a    return m.fromNow(true);\u000a}\u000a\u000afunction formatDate(unixTimestamp) {\u000a    if (!unixTimestamp) return "-";\u000a    return moment.unix(unixTimestamp).format(gettext(/* L10N: Date format */ "YYYY-MM-DD HH:mm"));\u000a}\u000a\u000afunction formatTimeAgo(unixTimestamp) {\u000a    if (!unixTimestamp) return "-";\u000a    return moment.unix(unixTimestamp).fromNow();\u000a}\u000a\u000afunction formatFilament(filament) {\u000a    if (!filament || !filament["length"]) return "-";\u000a    var result = "%(length).02fm";\u000a    if (filament.hasOwnProperty("volume") && filament.volume) {\u000a        result += " / " + "%(volume).02fcm³";\u000a    }\u000a    return _.sprintf(result, {length: filament["length"] / 1000, volume: filament["volume"]});\u000a}\u000a\u000afunction cleanTemperature(temp) {\u000a    if (!temp || temp < 10) return gettext("off");\u000a    return temp;\u000a}\u000a\u000afunction formatTemperature(temp) {\u000a    if (!temp || temp < 10) return gettext("off");\u000a    return _.sprintf("%.1f&deg;C", temp);\u000a}\u000a\u000afunction pnotifyAdditionalInfo(inner) {\u000a    return '<div class="pnotify_additional_info">'\u000a        + '<div class="pnotify_more"><a href="#" onclick="$(this).children().toggleClass(\u005c'icon-caret-right icon-caret-down\u005c').parent().parent().next().slideToggle(\u005c'fast\u005c')">More <i class="icon-caret-right"></i></a></div>'\u000a        + '<div class="pnotify_more_container hide">' + inner + '</div>'\u000a        + '</div>';\u000a}\u000a\u000afunction ping(url, callback) {\u000a    var img = new Image();\u000a    var calledBack = false;\u000a\u000a    img.onload = function() {\u000a        callback(true);\u000a        calledBack = true;\u000a    };\u000a    img.onerror = function() {\u000a        if (!calledBack) {\u000a            callback(true);\u000a            calledBack = true;\u000a        }\u000a    };\u000a    img.src = url;\u000a    setTimeout(function() {\u000a        if (!calledBack) {\u000a            callback(false);\u000a            calledBack = true;\u000a        }\u000a    }, 1500);\u000a}\u000a\u000afunction showOfflineOverlay(title, message, reconnectCallback) {\u000a    if (title == undefined) {\u000a        title = gettext("Server is offline");\u000a    }\u000a\u000a    $("#offline_overlay_title").text(title);\u000a    $("#offline_overlay_message").html(message);\u000a    $("#offline_overlay_reconnect").click(reconnectCallback);\u000a    if (!$("#offline_overlay").is(":visible"))\u000a        $("#offline_overlay").show();\u000a}\u000a\u000afunction hideOfflineOverlay() {\u000a    $("#offline_overlay").hide();\u000a}\u000a\u000afunction showConfirmationDialog(message, onacknowledge) {\u000a    var confirmationDialog = $("#confirmation_dialog");\u000a    var confirmationDialogAck = $(".confirmation_dialog_acknowledge", confirmationDialog);\u000a\u000a    $(".confirmation_dialog_message", confirmationDialog).text(message);\u000a    confirmationDialogAck.unbind("click");\u000a    confirmationDialogAck.bind("click", function (e) {\u000a        e.preventDefault();\u000a        $("#confirmation_dialog").modal("hide");\u000a        onacknowledge(e);\u000a    });\u000a    confirmationDialog.modal("show");\u000a}\u000a\u000afunction showReloadOverlay() {\u000a    $("#reloadui_overlay").show();\u000a}\u000a\u000afunction commentableLinesToArray(lines) {\u000a    return splitTextToArray(lines, "\u005cn", true, function(item) {return !_.startsWith(item, "#")});\u000a}\u000a\u000afunction splitTextToArray(text, sep, stripEmpty, filter) {\u000a    return _.filter(\u000a        _.map(\u000a            text.split(sep),\u000a            function(item) { return (item) ? item.trim() : ""; }\u000a        ),\u000a        function(item) { return (stripEmpty ? item : true) && (filter ? filter(item) : true); }\u000a    );\u000a}\u000a\u000avar sizeObservable = function(observable) {\u000a    return ko.computed({\u000a        read: function() {\u000a            return formatSize(observable());\u000a        },\u000a        write: function(value) {\u000a            var result = bytesFromSize(value);\u000a            if (result != undefined) {\u000a                observable(result);\u000a            }\u000a        }\u000a    })\u000a};\u000a\u000a;\u000a
p0
.